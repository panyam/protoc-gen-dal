// Code generated by protoc-gen-dal-gorm. DO NOT EDIT.
package {{ .PackageName }}

{{ if .Imports }}
import (
{{ range .Imports }}	"{{ . }}"
{{ end }}	"fmt"
	"time"

	"google.golang.org/protobuf/types/known/timestamppb"
)
{{ end }}

// Helper functions for built-in type conversions

// timestampToInt64 converts a protobuf Timestamp to Unix seconds (int64).
// Returns 0 if timestamp is nil.
func timestampToInt64(ts *timestamppb.Timestamp) int64 {
	if ts == nil {
		return 0
	}
	return ts.AsTime().Unix()
}

// int64ToTimestamp converts Unix seconds (int64) to a protobuf Timestamp.
// Returns nil if the input is 0.
func int64ToTimestamp(seconds int64) *timestamppb.Timestamp {
	if seconds == 0 {
		return nil
	}
	return timestamppb.New(time.Unix(seconds, 0))
}
{{ range .Converters }}
// mustConvert{{ .SourceType }}To{{ .GormType }} is a helper that calls {{ .SourceType }}To{{ .GormType }} and panics on error.
// Used for nested conversions where error handling is done at the top level.
func mustConvert{{ .SourceType }}To{{ .GormType }}(api *{{ .SourcePkgName }}.{{ .SourceType }}) {{ .GormType }} {
	result, err := {{ .SourceType }}To{{ .GormType }}(api, nil)
	if err != nil {
		panic(fmt.Sprintf("failed to convert {{ .SourceType }} to {{ .GormType }}: %v", err))
	}
	if result == nil {
		return {{ .GormType }}{}
	}
	return *result
}

// mustConvert{{ .SourceType }}From{{ .GormType }} is a helper that calls {{ .SourceType }}From{{ .GormType }} and panics on error.
// Used for nested conversions where error handling is done at the top level.
func mustConvert{{ .SourceType }}From{{ .GormType }}(gorm *{{ .GormType }}) *{{ .SourcePkgName }}.{{ .SourceType }} {
	result, err := {{ .SourceType }}From{{ .GormType }}(gorm, nil)
	if err != nil {
		panic(fmt.Sprintf("failed to convert {{ .GormType }} to {{ .SourceType }}: %v", err))
	}
	return result
}
{{ end }}
{{ range .Converters }}
// {{ .SourceType }}To{{ .GormType }} converts a {{ .SourcePkgName }}.{{ .SourceType }} to {{ .GormType }}.
// The optional decorator function allows custom field transformations.
func {{ .SourceType }}To{{ .GormType }}(
	api *{{ .SourcePkgName }}.{{ .SourceType }},
	decorator func(*{{ .SourcePkgName }}.{{ .SourceType }}, *{{ .GormType }}) error,
) (*{{ .GormType }}, error) {
	if api == nil {
		return nil, nil
	}

	gorm := &{{ .GormType }}{
{{ range .FieldMappings }}		{{ .GormField }}: {{ .ToGormCode }},
{{ end }}	}

	// Apply decorator if provided
	if decorator != nil {
		if err := decorator(api, gorm); err != nil {
			return nil, err
		}
	}

	return gorm, nil
}

// {{ .SourceType }}From{{ .GormType }} converts a {{ .GormType }} back to {{ .SourcePkgName }}.{{ .SourceType }}.
// The optional decorator function allows custom field transformations.
func {{ .SourceType }}From{{ .GormType }}(
	gorm *{{ .GormType }},
	decorator func(*{{ .GormType }}, *{{ .SourcePkgName }}.{{ .SourceType }}) error,
) (*{{ .SourcePkgName }}.{{ .SourceType }}, error) {
	if gorm == nil {
		return nil, nil
	}

	api := &{{ .SourcePkgName }}.{{ .SourceType }}{
{{ range .FieldMappings }}		{{ .SourceField }}: {{ .FromGormCode }},
{{ end }}	}

	// Apply decorator if provided
	if decorator != nil {
		if err := decorator(gorm, api); err != nil {
			return nil, err
		}
	}

	return api, nil
}
{{ end }}
