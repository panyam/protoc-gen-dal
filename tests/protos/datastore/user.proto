syntax = "proto3";

package datastore;

import "dal/v1/annotations.proto";
import "api/user.proto";  // Import API protos so they're available for source references
import "google/protobuf/timestamp.proto";

option go_package = "github.com/panyam/protoc-gen-dal/tests/gen/datastore;testdatastore";

// UserDatastore demonstrates basic Datastore entity with DAL generation
message UserDatastore {
  option (dal.v1.datastore_options) = {
    source: "api.User"
    kind: "User"
    dal: true
  };

  // ID field - stored in Key, excluded from properties via datastore_tags
  string id = 1 [(dal.v1.column) = {
    datastore_tags: ["-"]
  }];

  // Regular string field
  string name = 2;

  // Email field with noindex (demonstrates tag support)
  string email = 3 [(dal.v1.column) = {
    datastore_tags: ["noindex"]
  }];

  // Age field
  uint32 age = 4;

  // Timestamps stored as time.Time (Datastore native support)
  google.protobuf.Timestamp birthday = 5;
  google.protobuf.Timestamp created_at = 6;
  google.protobuf.Timestamp updated_at = 7;
}

// UserWithNamespace demonstrates namespace support
message UserWithNamespace {
  option (dal.v1.datastore_options) = {
    source: "api.User"
    kind: "User"
    namespace: "production"
  };

  string id = 1;
  string name = 2;
  string email = 3;
}

// UserWithLargeText demonstrates noindex for large text fields
message UserWithLargeText {
  option (dal.v1.datastore_options) = {
    source: "api.User"
    kind: "UserProfile"
  };

  string id = 1 [(dal.v1.column) = {
    datastore_tags: ["-"]
  }];
  string name = 2;

  // Biography - large text that shouldn't be indexed
  string email = 3 [(dal.v1.column) = {
    datastore_tags: ["noindex"]
  }];
}

// UserSimple - minimal test case
message UserSimple {
  option (dal.v1.datastore_options) = {
    source: "api.User"
    kind: "SimpleUser"
  };

  string id = 1;
  string name = 2;
}

// AuthorDatastore for embedded/nested message testing
message AuthorDatastore {
  option (dal.v1.datastore_options) = {
    source: "api.Author"
  };

  string name = 1;
  string email = 2;
}

// ProductDatastore demonstrates repeated and map fields with DAL generation
// Datastore natively supports repeated scalar values as array properties
message ProductDatastore {
  option (dal.v1.datastore_options) = {
    source: "api.Product"
    kind: "Product"
    dal: true
  };

  string id = 1 [(dal.v1.column) = {
    datastore_tags: ["-"]
  }];
  string name = 2;

  // Repeated scalars - Datastore stores as array properties
  repeated string tags = 3;           // Native Datastore array
  repeated string categories = 4;     // Native Datastore array

  // Map - no native support, but Go datastore library handles it
  // Using noindex and omitempty (multiple tags example)
  map<string, string> metadata = 5 [(dal.v1.column) = {
    datastore_tags: ["noindex", "omitempty"]
  }];

  // Repeated numbers - Datastore array
  repeated int32 ratings = 6;
}

// LibraryDatastore demonstrates repeated message types
// Datastore can store repeated Entity values
message LibraryDatastore {
  option (dal.v1.datastore_options) = {
    source: "api.Library"
    kind: "Library"
  };

  string id = 1;
  string name = 2;

  // Repeated message type - stored as nested entities
  repeated AuthorDatastore contributors = 3;
}

// OrganizationDatastore demonstrates map with message values
message OrganizationDatastore {
  option (dal.v1.datastore_options) = {
    source: "api.Organization"
    kind: "Organization"
  };

  string id = 1;
  string name = 2;

  // Map with message values - Datastore will serialize
  map<string, AuthorDatastore> departments = 3;
}
