
syntax = "proto3";

package gorm;

import "dal/v1/annotations.proto";
import "api/testany.proto";  // Import API protos so they're available for source references

option go_package = "github.com/panyam/protoc-gen-dal/tests/gen/dal;testdal";

// TestRecord1Gorm demonstrates GORM features for complex types including enums.
// Tests: plain enums, repeated enums, and map<string, enum>.
message TestRecord1Gorm {
  option (dal.v1.gorm) = {
    source: "api.TestRecord1"
    table: "test_records"
  };

  // Override the list_of_enums field to add serializer:json for SQLite compatibility
  repeated api.SampleEnum list_of_enums = 4 [(dal.v1.column) = {
    gorm_tags: "serializer:json"
  }];

  // Override the map_string_to_enum field to add serializer:json for SQLite compatibility
  map<string, api.SampleEnum> map_string_to_enum = 5 [(dal.v1.column) = {
    gorm_tags: "serializer:json"
  }];
}

// MapValueMessageGorm is the GORM model for api.MapValueMessage
message MapValueMessageGorm {
  option (dal.v1.gorm) = {
    source: "api.MapValueMessage"
  };

  string label = 1;
  int32 count = 2;
}

// TestRecord2Gorm tests GORM handling of maps with non-string keys.
// These maps contain proto message values with various key types.
message TestRecord2Gorm {
  option (dal.v1.gorm) = {
    source: "api.TestRecord2"
    table: "test_records2"
  };

  // Map with int32 keys containing message values
  map<int32, MapValueMessageGorm> int32_to_message = 2 [(dal.v1.column) = {
    gorm_tags: "serializer:json"
  }];

  // Map with int64 keys containing message values
  map<int64, MapValueMessageGorm> int64_to_message = 3 [(dal.v1.column) = {
    gorm_tags: "serializer:json"
  }];

  // Map with uint32 keys containing message values
  map<uint32, MapValueMessageGorm> uint32_to_message = 4 [(dal.v1.column) = {
    gorm_tags: "serializer:json"
  }];

  // Map with bool keys containing message values
  map<bool, MapValueMessageGorm> bool_to_message = 5 [(dal.v1.column) = {
    gorm_tags: "serializer:json"
  }];
}
