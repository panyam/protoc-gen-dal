syntax = "proto3";

package gorm;

import "dal/v1/annotations.proto";
import "weewar/v1/models.proto";
import "google/protobuf/any.proto";

option go_package = "github.com/panyam/protoc-gen-dal/tests/gen/dal;testdal";


message IndexInfoGORM {
  option (dal.v1.gorm) = { source: "weewar.v1.IndexInfo" };
}

message TileGORM {
  option (dal.v1.gorm) = { source: "weewar.v1.Tile" };
}

message UnitGORM {
  option (dal.v1.gorm) = { source: "weewar.v1.Unit" };
}

message AttackRecordGORM {
  option (dal.v1.gorm) = { source: "weewar.v1.AttackRecord" };
}

message WorldGORM {
  option (dal.v1.gorm) = { source: "weewar.v1.World", table: "worlds" };
  string id = 1 [(dal.v1.column) = {
    gorm_tags: ["primaryKey"]
  }];
}

message WorldDataGORM {
  option (dal.v1.gorm) = { source: "weewar.v1.WorldData", table: "world_data" };
  string world_id = 1 [(dal.v1.column) = {
    gorm_tags: ["primaryKey"]
  }];
}

///////// Game related models


// Describes a game and its metadata
message GameGORM {
  option (dal.v1.gorm) = { source: "weewar.v1.Game", table: "games" };
  string id = 1 [(dal.v1.column) = {
    gorm_tags: ["primaryKey"]
  }];
}

message GameConfigurationGORM {
  option (dal.v1.gorm) = { source: "weewar.v1.GameConfiguration" };
}

message IncomeConfigGORM {
  option (dal.v1.gorm) = { source: "weewar.v1.IncomeConfig" };
}

message GamePlayerGORM {
  option (dal.v1.gorm) = { source: "weewar.v1.GamePlayer" };
}

message GameTeamGORM {
  option (dal.v1.gorm) = { source: "weewar.v1.GameTeam" };
}

message GameSettingsGORM {
  option (dal.v1.gorm) = { source: "weewar.v1.GameSettings" };
}

// Holds the game's Active/Current state (eg world state)
message GameStateGORM {
  option (dal.v1.gorm) = { source: "weewar.v1.GameState" };
  string game_id = 1 [(dal.v1.column) = {
    gorm_tags: ["primaryKey"]
  }];
}

// Holds the game's move history (can be used as a replay log)
message GameMoveHistoryGORM {
  option (dal.v1.gorm) = { source: "weewar.v1.GameMoveHistory" };
}

// A move group - we can allow X moves in one "tick"
message GameMoveGroupGORM {
  option (dal.v1.gorm) = { source: "weewar.v1.GameMoveGroup" };
}

/**
 * Represents a single move which can be one of many actions in the game
 */
message GameMoveGORM {
  option (dal.v1.gorm) = { source: "weewar.v1.GameMove" };

  string game_id = 1 [(dal.v1.column) = { gorm_tags: ["primaryKey"] }];
  string group_number = 2 [(dal.v1.column) = { gorm_tags: ["primaryKey"] }];
  int32 move_number = 3 [(dal.v1.column) = { gorm_tags: ["primaryKey"] }];

  // Field named "move_type" matches the oneof name in source
  // This automatically skips all oneof members (move_unit, attack_unit, end_turn, build_unit)
  google.protobuf.Any move_type = 4;

  repeated google.protobuf.Any changes = 5;
}
